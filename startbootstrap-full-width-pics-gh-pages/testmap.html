<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Forrest Gump - Main Events Map with Time Slider</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <link href="css/styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster-src.js"></script>

    <!-- Leaflet Time-Slider Plugin -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.js"></script>
    <script src="https://unpkg.com/leaflet-timedimension/dist/leaflet.timedimension.min.js"></script>

    <style>
        #map {
            position: absolute;
            height: 90vh;
            width: 100%;
        }
        #slider {
            position: absolute;
            bottom: 20px;
            left: 50px;
            width: 90%;
            z-index: 1000;
        }
    </style>
</head>

<body>
     <!-- Responsive navbar-->
     <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#!">Memory Forest Memory</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="#!">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#!">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="#!">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div id="map"></div>
    <div id="slider"></div> <!-- Slider container -->

    <script>
        // Initialize map centered in the USA
        var map = L.map('map').setView([39.8283, -98.5795], 4);
        var baseLayer = L.tileLayer('https://api.maptiler.com/maps/bright-v2/{z}/{x}/{y}.png?key=9ZlnxkRt2oS8TwA1JdFu', {
            attribution: '&copy; MapTiler &copy; OpenStreetMap contributors'
        });
        
        // Custom marker icon
        var iconOptions = {
        iconUrl: src="images/pin.png", // Updated to use your custom icon
        iconSize: [55, 55]      // Size of the custom icon
        };
        var customIcon = L.icon(iconOptions);
        var markerOptions = { icon: customIcon };

        // Forrest Gump main event locations with timestamps
        var markers = [
        {
        position: [32.3792, -86.3077],
        popup: `
        <b>Greenbow, Alabama</b><br>
        Forrest's hometown.<br>
        <p>Moragahakanda Dam: The dam generates power from three 67 MW turbines, with a total installed capacity of 201 MW, making it the second largest hydroelectric power station in Sri Lanka. Construction on the dam began in August 1979 and was ceremonially completed in February 1985.</p>
        <img src="images/sample.jpg" style="width: 150px">
        `,
        year: 1951
        }
        ];

        markers.push({
        position: [38.9072, -77.0369],
        popup: `
        <b>Washington, D.C.</b><br>
        The nation's capital.<br>
        <p>This is where Forrest meets the president and participates in rallies.</p>
        <img src="images/washington.jpg" style="width: 150px">
        `,
        year: 1967
        });

        //Add your codes for the markers after this line
        markers.push({
        position: [38.9072, -77.0369],
        popup: `
        <b>Washington, D.C.</b><br>
        The nation's capital.<br>
        <p>This is where Forrest meets the president and participates in rallies.</p>
        <img src="images/washington.jpg" style="width: 150px">
        `,
        year: 1967
        });


        // Add markers with timestamps to map
        var eventsLayer = L.layerGroup();
        markers.forEach(function(event) {
            var marker = L.marker(event.position, markerOptions).bindPopup(event.popup);
            marker.options.year = event.year;  // Add a custom 'year' property to each marker
            eventsLayer.addLayer(marker);
        });

        // Add base layer and events layer
        baseLayer.addTo(map);
        eventsLayer.addTo(map);

        // Initialize the time slider
        noUiSlider.create(document.getElementById('slider'), {
            start: [1951],
            connect: true,
            range: { 'min': 1951, 'max': 1981 },
            step: 1,
            tooltips: true,
            format: {
                from: Number,
                to: function(value) { return Math.round(value); }
            }
        });

        // Update markers based on slider year
        document.getElementById('slider').noUiSlider.on('update', function(values) {
            var currentYear = parseInt(values[0]);
            eventsLayer.clearLayers(); // Remove all markers
            markers.forEach(function(event) {
                if (event.year <= currentYear) {
                    var marker = L.marker(event.position, markerOptions).bindPopup(event.popup);
                    eventsLayer.addLayer(marker); // Add marker if its year is <= selected year
                }
            });
        });
        markers.forEach(markerData => {
    L.marker(markerData.position, markerOptions)
        .addTo(map)
        .bindPopup(markerData.popup);
});

        // Layer controls for map
        var baseMaps = { "Map": baseLayer };
        var overlayMaps = { "Forrest Gump Events": eventsLayer };
        L.control.layers(baseMaps, overlayMaps).addTo(map);
    </script>
</body>

</html>